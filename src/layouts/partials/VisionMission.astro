---
import { markdownify } from "@/lib/utils/textConverter";
import type { CollectionEntry } from "astro:content";
import { getEntry } from "astro:content";

const { subtitle, vision, mission } = (
  (await getEntry(
    "visionMissionSection",
    "vision-mission"
  )) as CollectionEntry<"visionMissionSection">
).data;
---

<section class="section vision-mission-section">
  <div class="container">
    <div class="row">
      <div class="mx-auto text-center lg:col-10" data-aos="fade-up-sm">
        {
          subtitle && (
            <h2
              class="mb-10 font-medium text-tertiary"
              set:html={markdownify(subtitle)}
            />
          )
        }
      </div>
      <div class="col-12 pt-10">
        <div class="row g-4 justify-center">
          {
            vision && (
              <div class="md:col-6" data-aos="fade-up-sm">
                <div class="vision-mission-card min-h-full rounded-xl bg-light p-8 md:rounded-3xl md:p-10" data-cursor="Vision">
                  <div class="card-bg"></div>
                  <div class="card-content">
                    <h3 class="h4 mb-4" set:html={markdownify(vision.title)} />
                    <p class="text-lg/[inherit] mb-0" set:html={markdownify(vision.content)} />
                  </div>
                </div>
              </div>
            )
          }
          {
            mission && (
              <div class="md:col-6" data-aos="fade-up-sm" data-aos-delay="100">
                <div class="vision-mission-card min-h-full rounded-xl bg-tertiary p-8 text-text-light md:rounded-3xl md:p-10" data-cursor="Mission">
                  <div class="card-bg"></div>
                  <div class="card-content">
                    <h3 class="h4 mb-4 text-inherit" set:html={markdownify(mission.title)} />
                    <p class="text-lg/[inherit] mb-0 text-inherit" set:html={markdownify(mission.content)} />
                  </div>
                </div>
              </div>
            )
          }
        </div>
      </div>
    </div>
  </div>
  <div class="custom-cursor">
    <p>Learn more</p>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const cursor = document.querySelector('.custom-cursor') as HTMLElement;
    const cards = document.querySelectorAll('[data-cursor]');
    
    if (!cursor || !cards.length) return;

    let mouseX = 0;
    let mouseY = 0;
    let cursorX = 0;
    let cursorY = 0;

    document.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
    });

    cards.forEach(card => {
      card.addEventListener('mouseenter', () => {
        cursor.style.opacity = '1';
        const text = card.getAttribute('data-cursor') || 'Learn more';
        const cursorText = cursor.querySelector('p');
        if (cursorText) {
          cursorText.textContent = text;
        }
      });

      card.addEventListener('mouseleave', () => {
        cursor.style.opacity = '0';
      });
    });

    function animateCursor() {
      cursorX += (mouseX - cursorX) * 0.1;
      cursorY += (mouseY - cursorY) * 0.1;
      cursor.style.left = cursorX + 'px';
      cursor.style.top = cursorY + 'px';
      requestAnimationFrame(animateCursor);
    }
    animateCursor();
  });
</script>

<style>
  .vision-mission-section {
    position: relative;
  }

  .vision-mission-card {
    position: relative;
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .card-bg {
    position: absolute;
    inset: 0;
    z-index: 0;
    border-radius: inherit;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    background-color: inherit;
  }

  .card-content {
    position: relative;
    z-index: 1;
  }

  .vision-mission-card:hover .card-bg {
    transform: scale(0.95);
  }

  .custom-cursor {
    z-index: 1000;
    background-color: var(--color-primary, #000);
    opacity: 0;
    pointer-events: none;
    color: var(--color-light, #fff);
    border-radius: 0.25em;
    padding: 0.3em 0.75em 0.4em;
    font-size: 1.15em;
    line-height: 1.5;
    transition: opacity 0.2s;
    position: fixed;
    top: 0;
    left: 0;
  }

  .custom-cursor p {
    margin: 0;
  }

  body:has([data-cursor]:hover) .custom-cursor {
    opacity: 1;
  }
</style>

