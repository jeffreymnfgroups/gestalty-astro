---
import { markdownify } from "@/lib/utils/textConverter";
import type { CollectionEntry } from "astro:content";
import { getEntry } from "astro:content";
import LottieAnimation from "@/components/LottieAnimation";

const { title, subtitle, description, pillars } = (
  (await getEntry(
    "scienceFoundationSection",
    "science-foundation"
  )) as CollectionEntry<"scienceFoundationSection">
).data;

const accentPalette = [
  {
    surface: "#0f3d5c",
    text: "#f7fafc",
    muted: "#cfd5e2",
    accent: "#fbc10d",
    border: "rgba(251, 193, 13, 0.3)",
    shadow: "rgba(0, 0, 0, 0.45)"
  },
  {
    surface: "#19254c",
    text: "#e8edf7",
    muted: "#c6d0e9",
    accent: "#fbc10d",
    border: "rgba(251, 193, 13, 0.28)",
    shadow: "rgba(25, 37, 76, 0.55)"
  },
  {
    surface: "#f6eddf",
    text: "#1e1e1e",
    muted: "#3a3a3a",
    accent: "#19254c",
    border: "rgba(25, 37, 76, 0.16)",
    shadow: "rgba(0, 0, 0, 0.28)"
  },
  {
    surface: "#fbc10d",
    text: "#161616",
    muted: "#2d2d2d",
    accent: "#19254c",
    border: "rgba(0, 0, 0, 0.15)",
    shadow: "rgba(251, 193, 13, 0.45)"
  }
];

// Reuse existing lottie assets for the pillars
const pillarLotties = [
  "/images/pillar1.lottie",
  "/images/pillar2.lottie",
  "/images/pillar3.lottie",
  "/images/pillar4.lottie"
];
---

<section class="sf-section">
  <div class="sf-shell">
    <header class="sf-header">
      {title && <h2 class="sf-title" set:html={markdownify(title)} />}
      {subtitle && <p class="sf-subtitle" set:html={markdownify(subtitle)} />}
      {description && (
        <p class="sf-description" set:html={markdownify(description)} />
      )}
    </header>

    <div class="sf-cards">
      {pillars?.map((pillar, index) => {
        const palette = accentPalette[index % accentPalette.length];

        return (
          <article
            class="sf-card"
            style={`--accent:${palette.accent};--surface:${palette.surface};--text:${palette.text};--muted:${palette.muted};--border:${palette.border};--shadow:${palette.shadow};`}
          >
            <div class="sf-media">
              <div class="sf-lottie">
                <LottieAnimation
                  src={pillarLotties[index % pillarLotties.length]}
                  client:only="react"
                  className="w-full h-full"
                />
              </div>
            </div>
            <div class="sf-card-headings">
              <p class="sf-card-kicker">Pillar {index + 1}</p>
              <h3 class="sf-card-title">{pillar.title}</h3>
              {pillar.tagline && (
                <p class="sf-card-tagline" set:html={markdownify(pillar.tagline)} />
              )}
            </div>

            {pillar.list && pillar.list.length > 0 && (
              <ul class="sf-card-list">
                {pillar.list.map((item) => (
                  <li>{item}</li>
                ))}
              </ul>
            )}
          </article>
        );
      })}
    </div>
  </div>
</section>

<style>
  .sf-section {
    background: #ffffff;
    color: #0f172a;
    padding: 4.5rem 1.5rem 3.5rem;
  }

  .sf-shell {
    max-width: 1200px;
    margin: 0 auto;
  }

  .sf-header {
    text-align: center;
    margin: 0 auto 2.75rem;
    max-width: 860px;
  }

  .sf-title {
    font-size: clamp(2rem, 3vw, 2.8rem);
    font-weight: 800;
    letter-spacing: -0.02em;
    margin-bottom: 0.7rem;
  }

  .sf-subtitle {
    font-size: 1.05rem;
    color: #4b5563;
    line-height: 1.7;
    margin: 0 auto 0.8rem;
  }

  .sf-description {
    font-size: 0.98rem;
    color: #6b7280;
    line-height: 1.7;
    margin: 0;
  }

  .sf-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.25rem;
    align-items: stretch;
  }

  .sf-card {
    background: var(--surface);
    color: var(--text, #f8fafc);
    border: 1px solid var(--border, rgba(255, 255, 255, 0.08));
    border-radius: 16px;
    padding: 1.4rem;
    box-shadow: 0 10px 30px var(--shadow, rgba(15, 23, 42, 0.3));
    display: flex;
    flex-direction: column;
    gap: 0.9rem;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .sf-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 16px 38px rgba(15, 23, 42, 0.14);
  }

  .sf-media {
    display: flex;
    align-items: center;
    justify-content: flex-start;
  }

  .sf-lottie {
    background: transparent;
    border: none;
    border-radius: 0;
    padding: 0;
    height: 120px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .sf-card-headings {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .sf-card-kicker {
    font-size: 0.8rem;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--accent);
    margin: 0;
  }

  .sf-card-title {
    font-size: 1.25rem;
    font-weight: 800;
    letter-spacing: -0.01em;
    text-decoration: underline;
    text-decoration-color: var(--accent);
    text-decoration-thickness: 0.14em;
    text-underline-offset: 0.22em;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    margin: 0;
    color: var(--text, #f8fafc);
  }

  .sf-card-tagline {
    margin: 0;
    color: var(--muted, #d7deee);
    font-size: 0.97rem;
    line-height: 1.6;
  }

  .sf-card-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: 0.55rem;
  }

  .sf-card-list li {
    position: relative;
    padding-left: 1.3rem;
    font-size: 0.95rem;
    line-height: 1.6;
    color: var(--text, #f8fafc);
  }

  .sf-card-list li::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0.6em;
    transform: none;
    width: 8px;
    height: 8px;
    border-radius: 999px;
    border: none;
    background: var(--accent);
    box-sizing: border-box;
  }

  @media (max-width: 640px) {
    .sf-section {
      padding: 3.5rem 1.1rem 3rem;
    }

    .sf-card {
      padding: 1.4rem;
    }

    .sf-card-title {
      font-size: 1.15rem;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .sf-card,
    .sf-card:hover {
      transition: none;
      transform: none;
      box-shadow: 0 12px 36px rgba(15, 23, 42, 0.08);
    }
  }
</style>
